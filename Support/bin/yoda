#!/usr/bin/env python

"""Usage: yoda <line> <column> <path>

Read Python source on stdin, parse it with Jedi, return its completions.
"""


from __future__ import print_function

import plistlib
import sys

import jedi


def main(line, column, path=None):
    source = sys.stdin.read()
    script = jedi.Script(source, line, column, path)
    return [{'display': c.name, 'image': c.type}
            for c in script.completions()]


def write(completions):
    print(plistlib.writePlistToString(completions))


if __name__ == '__main__':
    line, column, path = sys.argv[1:]
    write(main(int(line), int(column), path))
